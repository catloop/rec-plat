!function(e){"use strict";var t={};t.index={state:"index",config:{url:"/",templateUrl:"tpls/index.html",controller:"indexCtrl"},title:"首页"},t.overview={state:"overview",config:{url:"/overview",templateUrl:"tpls/overview.html",controller:"overviewCtrl"},title:"服务全览"},t.demo={state:"demo",config:{url:"/demo",views:{"@":{templateUrl:"tpls/demo.html",controller:"demoCtrl"}}},title:"算法演示"},t["demo.face"]={state:"demo.face",config:{url:"/face",views:{"@":t.demo.config.views["@"],"subView@demo.face":{templateUrl:"tpls/demo/face.html",controller:"demoFaceCtrl"}}},title:"人脸比对"},t["demo.idCard"]={state:"demo.idCard",config:{url:"/idCard",views:{"@":t.demo.config.views["@"],"subView@demo.idCard":{templateUrl:"tpls/demo/idCard.html",controller:"demoIdCardCtrl"},"subViewBatch@demo.idCard":{templateUrl:"tpls/demo/Batch.html",controller:"demoBatchCtrl"}}},title:"身份证识别"},t["demo.creditCard"]={state:"demo.creditCard",config:{url:"/creditCard",views:{"@":t.demo.config.views["@"],"subView@demo.creditCard":{templateUrl:"tpls/demo/creditCard.html",controller:"demoCreditCardCtrl"},"subViewBatch@demo.creditCard":{templateUrl:"tpls/demo/Batch.html",controller:"demoBatchCtrl"}}},title:"银行卡识别"},t["demo.vat"]={state:"demo.vat",config:{url:"/vat",views:{"@":t.demo.config.views["@"],"subView@demo.vat":{templateUrl:"tpls/demo/vat.html",controller:"demoVatCtrl"},"subViewBatch@demo.vat":{templateUrl:"tpls/demo/Batch.html",controller:"demoBatchCtrl"}}},title:"增值税发票识别"},t["demo.finSta"]={state:"demo.finSta",config:{url:"/finSta",views:{"@":t.demo.config.views["@"],"subView@demo.finSta":{templateUrl:"tpls/demo/finSta.html",controller:"demoFinStaCtrl"},"subViewBatch@demo.finSta":{templateUrl:"tpls/demo/Batch.html",controller:"demoBatchCtrl"}}},title:"财务报表识别"},t["demo.busLis"]={state:"demo.busLis",config:{url:"/busLis",views:{"@":t.demo.config.views["@"],"subView@demo.busLis":{templateUrl:"tpls/demo/busLis.html",controller:"demoBusLisCtrl"},"subViewBatch@demo.busLis":{templateUrl:"tpls/demo/Batch.html",controller:"demoBatchCtrl"}}},title:"营业执照识别"},t["demo.fullText"]={state:"demo.fullText",config:{url:"/fullText",views:{"@":t.demo.config.views["@"],"subView@demo.fullText":{templateUrl:"tpls/demo/fullText.html",controller:"demoFullTextCtrl"}}},title:"全文字识别"},t["demo.silentLive"]={state:"demo.silentLive",config:{url:"/silentLive",views:{"@":t.demo.config.views["@"],"subView@demo.silentLive":{templateUrl:"tpls/demo/silentLive.html",controller:"demoSilentLiveCtrl"}}},title:"静默活体检测"},t.doc={state:"doc",config:{url:"/doc",templateUrl:"tpls/doc.html",controller:"docCtrl"},title:"开发接入"},t.price={state:"price",config:{url:"/price",templateUrl:"tpls/price.html",controller:"priceCtrl"},title:"价格方案"},t.accessGuide={state:"accessGuide",config:{url:"/accessGuide",templateUrl:"tpls/accessGuide.html"},title:"接入指南"},t.APIDoc={state:"APIDoc",config:{url:"/APIDoc",templateUrl:"tpls/APIDoc.html"},title:"API 文档"},t.SDKDownload={state:"SDKDownload",config:{url:"/SDKDownload",templateUrl:"tpls/SDKDownload.html"},title:"SDK 下载"},t.contact={state:"contact",config:{url:"/contact",templateUrl:"tpls/contact.html",controller:"contactCtrl"},title:"联系我们"},t.FAQ={state:"FAQ",config:{url:"/FAQ",templateUrl:"tpls/FAQ.html"},title:"常见问题"};e.module("mpsApp",["ui.router","ui.router.state.events","mpsCtrls","mpsDirectives","mpsSrvs","mpsFilters","ngSanitize"]).config(["$urlRouterProvider","$stateProvider","$compileProvider",function(e,i,a){i.state(t.index.state,t.index.config).state(t.overview.state,t.overview.config).state(t.demo.state,t.demo.config).state(t["demo.face"].state,t["demo.face"].config).state(t["demo.idCard"].state,t["demo.idCard"].config).state(t["demo.creditCard"].state,t["demo.creditCard"].config).state(t["demo.vat"].state,t["demo.vat"].config).state(t["demo.finSta"].state,t["demo.finSta"].config).state(t["demo.busLis"].state,t["demo.busLis"].config).state(t["demo.fullText"].state,t["demo.fullText"].config).state(t["demo.silentLive"].state,t["demo.silentLive"].config).state(t.doc.state,t.doc.config).state(t.price.state,t.price.config).state(t.accessGuide.state,t.accessGuide.config).state(t.APIDoc.state,t.APIDoc.config).state(t.SDKDownload.state,t.SDKDownload.config).state(t.contact.state,t.contact.config).state(t.FAQ.state,t.FAQ.config),e.when("","/").otherwise("/"),a.aHrefSanitizationWhitelist(/^\s*(https?|fil‌​e|blob|ftp|mailto|ch‌​rome-extension):/)}]).run(["$rootScope","$state","$stateParams","$window","$location","$anchorScroll",function(e,i,a,n,s,o){e.routers=t,e.$state=i,e.$stateParams=a,e.$on("$stateChangeStart",function(t,i,a,n,s){e.spinnerShow=!0}),e.$on("$stateChangeSuccess",function(a,s,l,r,d){if(n.setTimeout(function(){e.spinnerShow=!1,e.$apply("spinnerShow")},500),"demo"===i.current.name&&i.go("demo.face"),"index"===i.current.name)e.title="微模式";else{for(var c=[],u=i.current.name.split("."),m=[],f=0;f<u.length;f++)m.push(u[f]),c.unshift(" - "),c.unshift(t[m.join(".")].title);c.push("微模式"),e.title=c.join("")}n.sessionStorage.getItem("anchor")||o("main")})}])}(window.angular),function(e){"use strict";e.module("mpsCtrls",[]).controller("mainCtrl",["$scope","$rootScope","$window",function(e,t,i){"1.0.16"!==window.localStorage.getItem("version")&&(window.localStorage.clear(),window.localStorage.setItem("version","1.0.16")),i.sessionStorage.getItem("visitorFlag")||i.sessionStorage.setItem("visitorFlag",Math.random().toString(36).substring(2)),t.docMode=!1}]).controller("indexCtrl",["$scope",function(e){e.$on("$viewContentLoaded",function(){$(".carousel").carousel({interval:5e3})})}]).controller("loginCtrl",["$scope","$rootScope","$http","$element","$window","Api","DataSrv",function(e,t,i,a,n,s,o){/uuid\=/.test(document.cookie)&&n.localStorage.getItem("uuid")||(n.localStorage.setItem("uuid",o.uuid()),document.cookie="uuid="+n.localStorage.getItem("uuid")),i({method:"POST",url:s.loginStatus,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"uuid="+n.localStorage.getItem("uuid")}).then(function(i){"success"===i.data.status?(e.isLogin=!0,e.userName=i.data.userName):(e.isLogin=!1,e.userName=""),"Y"===i.data.onlinePayFlag?t.payOpen=!0:t.payOpen=!1});var l=a.find("#hideForm");e.uuidVal=n.localStorage.getItem("uuid"),e.login=function(){e.action=s.login},e.regist=function(){e.action=s.regist},e.trigAct=function(e){l.trigger("submit")},e.logout=function(){i({method:"POST",url:s.logout,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"uuid="+n.localStorage.getItem("uuid")}).then(function(e){console.log(e),"success"===e.data.status&&n.location.reload()})}}]).controller("overviewCtrl",["$window","$scope",function(e,t){t.setAnchor=function(t){e.sessionStorage.setItem("anchor",t)}}]).controller("demoCtrl",["$scope","$timeout","$element","$window","$rootScope","$state","Texts",function(e,t,i,a,n,s,o){var l=o.demoTexts;e.mode={value:"single"},e.$on("$viewContentLoaded",function(){e.demoText=l[s.current.name],e.allowTemplateSel="demo.busLis"===s.current.name,e.allowFieldConf="demo.vat"===s.current.name||"demo.busLis"===s.current.name,e.isFace="demo.face"===s.current.name,e.isIdCard="demo.idCard"===s.current.name,e.isCreditCard="demo.creditCard"===s.current.name,e.isVat="demo.vat"===s.current.name,e.isFinSta="demo.finSta"===s.current.name,e.isBusLis="demo.busLis"===s.current.name,e.isFullText="demo.fullText"===s.current.name,e.isSilentLive="demo.silentLive"===s.current.name,e.allowModeSel=!(e.isFace||e.isFullText||e.isSilentLive)});var r=$(window).width(),d=i.find(".tab-tits ul"),c=0;if(d.find("li").each(function(e,t){c+=$(t).width()}),r<c){d.width(c+15);var u=function(e){e&&e.length&&(e.offset().left+e.width()>r?h+=r-(e.offset().left+e.width()):e.offset().left<0&&(h-=e.offset().left),d.css("transition","transform .3s"),d.css("transform","translate("+h+"px)"))},m=r-d.width(),f=0,p=0,h=0;d.on("touchstart",function(e){f=e.touches[0].clientX-h,d.css("transition","")}),d.on("touchmove",function(e){(h=e.touches[0].clientX-f)>0?h/=5:h<m&&(h=m+(h-m)/5),d.css("transform","translate("+h+"px)")}),$(window).on("touchend",function(e){p=e.changedTouches[0].clientX,(h=p-f)>0&&(h=0),h<m&&(h=m),d.css("transition","transform .3s"),d.css("transform","translate("+h+"px)")}),d.on("transitionend",function(){d.css("transition","")}),d.find("li").on("click",function(e){var t=$(e.currentTarget);u(t)});var g=function(){t(function(){var e=i.find("li.active");e.length?u(e):g()},0,!1)};g()}t(function(){e.canvasWidth=i.find(".main-img").width(),e.canvasHeight=i.find(".main-img").height(),i.find(".thumb-list").append('<li class="thumb-item"></li>'),e.thumbWidth=i.find(".thumb-item").width(),e.thumbHeight=i.find(".thumb-item").height(),i.find(".thumb-list .thumb-item").remove(),e.$apply("canvasWidth","canvasHeight","thumbWidth","thumbHeight")},100,!1)}]).controller("demoFaceCtrl",["$scope","$rootScope","$window","$timeout","$element","FileSrv","$http","Api","NetSrv","UI","$state",function(e,t,i,a,n,s,o,l,r,d,c){e.dataList=[{file:[],base64:[]},{file:[],base64:[]}],e.activeIndex=[0,0],e.simi="";var u={visitorFlag:i.sessionStorage.getItem("visitorFlag")};e.dataReady=!!u.img1&&!!u.img2;var m=function(t){e.simi=(100*parseFloat(t.mpRecognition.ocrInfoList.ocrInfo.ocrResult.ucScore)).toString().substr(0,5)+"%"};e.compare=function(){e.dataReady&&r.ajaxFw({url:l.face,data:r.obj2QStr(u),processor:m,fail:function(){d.modalAlert({title:"错误",content:"识别失败"}),e.simi=""},failAlert:!0})},e.fileChanged=function(t,i){t.files.length&&/^image\/\w+$/g.test(t.files[0].type)&&s.imgCompress({file:t.files[0],maxPix:4915200,maxByte:1048576,cpsRatio:.7}).then(function(t){s.file2base64(t).then(function(o){e.dataList[i].file.length<5?(e.dataList[i].file.push(t),e.dataList[i].base64.push(o),e.activeIndex[i]=e.dataList[i].file.length-1):(e.dataList[i].file[e.activeIndex[i]]=t,e.dataList[i].base64[e.activeIndex[i]]=o),a(function(){s.canvasRender(n.find(".main-img canvas")[i],e.dataList[i].file[e.activeIndex[i]]),s.canvasRender(n.find(".thumb-list:eq("+i+") .thumb-item:eq("+e.activeIndex[i]+") canvas")[0],e.dataList[i].file[e.activeIndex[i]])},0,!1),u["img"+(i+1)]=o,u["imgName"+(i+1)]=t.name,e.dataReady=!!u.img1&&!!u.img2,e.$apply("dataReady")})})},e.activeChanged=function(t,i){e.activeIndex[t]=i,console.log(e.dataList),s.canvasRender(n.find(".main-img canvas")[t],e.dataList[t].file[i]),u["img"+(t+1)]=e.dataList[t].base64[i],u["imgName"+(t+1)]=e.dataList[t].file[i].name}}]).controller("demoIdCardCtrl",["$scope","$window","Api","FileSrv","NetSrv","$http","UI",function(e,t,i,a,n,s,o){e.dataList={file:[],base64:[]},e.activeIndex=0,e.imgSrc=e.dataList.base64[e.activeIndex];var l={visitorFlag:t.sessionStorage.getItem("visitorFlag")},r=function(t){e.failed=!1;for(var i=t.mpRecognition.ocrInfoList.ocrInfo.ocrResult,a={},n=0;n<i.length;n++)for(var s in i[n])a[s]=i[n][s];e.result={name:a.ucName,gender:a.ucSex,nation:a.ucNat,birth:a.ucBirth,address:a.ucAddress,idnum:a.ucNumber,organ:a.ucIssueUint,validate:a.ucValidDate}},d=function(t){e.result={},e.message=t.mpRecognition.resMsg,e.failed=!0};e.fileChanged=function(t){t.files.length&&/^image\/\w+$/g.test(t.files[0].type)&&a.file2base64(t.files[0]).then(function(a){e.dataList.file.length<5?(e.dataList.file.push(t.files[0]),e.dataList.base64.push(a),e.activeIndex=e.dataList.file.length-1):(e.dataList.file[e.activeIndex]=t.files[0],e.dataList.base64[e.activeIndex]=a),e.imgSrc=a,e.$apply("imgSrc"),l.img1=a,l.imgName1=t.files[0].name,n.ajaxFw({url:i.idCard,data:n.obj2QStr(l),processor:r,fail:d})})},e.activeChanged=function(t){e.activeIndex=t,e.imgSrc=e.dataList.base64[e.activeIndex],l.img1=e.imgSrc,l.imgName1=e.dataList.file[t].name,n.ajaxFw({url:i.idCard,data:n.obj2QStr(l),processor:r,fail:d})}}]).controller("demoCreditCardCtrl",["$scope","$window","Api","FileSrv","NetSrv","$http","UI",function(e,t,i,a,n,s,o){e.dataList={file:[],base64:[]},e.activeIndex=0,e.imgSrc=e.dataList.base64[e.activeIndex];var l={visitorFlag:t.sessionStorage.getItem("visitorFlag")},r=function(t){e.failed=!1;for(var i=t.mpRecognition.ocrInfoList.ocrInfo.ocrResult,a={},n=0;n<i.length;n++)for(var s in i[n])a[s]=i[n][s];e.result={cardNum:a.ucCardNum,cardName:a.ucBankName}},d=function(t){e.failed=!0,e.message=t.mpRecognition.resMsg,e.result={}};e.fileChanged=function(t){t.files.length&&/^image\/\w+$/g.test(t.files[0].type)&&a.file2base64(t.files[0]).then(function(a){e.dataList.file.length<5?(e.dataList.file.push(t.files[0]),e.dataList.base64.push(a),e.activeIndex=e.dataList.file.length-1):(e.dataList.file[e.activeIndex]=t.files[0],e.dataList.base64[e.activeIndex]=a),e.imgSrc=a,e.$apply("imgSrc"),l.img1=a,l.imgName1=t.files[0].name,n.ajaxFw({url:i.creditCard,data:n.obj2QStr(l),processor:r,fail:d})})},e.activeChanged=function(t){e.activeIndex=t,e.imgSrc=e.dataList.base64[e.activeIndex],l.img1=e.imgSrc,l.imgName1=e.dataList.file[t].name,n.ajaxFw({url:i.creditCard,data:n.obj2QStr(l),processor:r,fail:d})}}]).controller("demoVatCtrl",["$scope","$window","Api","Texts","FileSrv","NetSrv","DataSrv","$http","UI",function(e,t,i,a,n,s,o,l,r){e.transText=a.trans.vat,e.dataList={file:[],base64:[]},e.activeIndex=0,e.imgSrc=e.dataList.base64[e.activeIndex];var d=function(t){e.failed=!1;var i={},a=o.dataFlat(t.mpRecognition.ocrInfoList.ocrInfo.ocrResult);for(var n in a)"invoiceCode"!==n&&"invoiceNumber"!==n||(i[n]=a[n]);for(var n in a)"invoiceCode"===n&&"invoiceNumber"===n||(i[n]=a[n]);a.detail&&a.detail.length?(e.detail=a.detail,delete a.detail):e.detail=null,e.common=a},c=function(t){e.failed=!0,e.message=t.mpRecognition.resMsg,e.result=""};e.fields=a.getConfig(),e.saveConfig=function(){a.saveConfig(e.fields)};var u=function(){return a.openField(e.fields)};e.$watch("fields",function(t,i){if(t!==i){var a=!0;for(var n in t)t[n].display&&t[n].checked&&(a=!1);e.saveDisabled=a}},!0),e.fileChanged=function(a){a.files.length&&/^image\/\w+$/g.test(a.files[0].type)&&(n.file2base64(a.files[0]).then(function(t){e.dataList.file.length<5?(e.dataList.file.push(a.files[0]),e.dataList.base64.push(t),e.activeIndex=e.dataList.file.length-1):(e.dataList.file[e.activeIndex]=a.files[0],e.dataList.base64[e.activeIndex]=t),e.imgSrc=t,e.$apply("imgSrc")}),s.ajaxFw({url:i.vat,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n.formData({myfile:a.files[0],visitorFlag:t.sessionStorage.getItem("visitorFlag"),openField:u()}),processor:d,fail:c}))},e.activeChanged=function(a){e.activeIndex=a,e.imgSrc=e.dataList.base64[e.activeIndex],s.ajaxFw({url:i.vat,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n.formData({myfile:e.dataList.file[a],visitorFlag:t.sessionStorage.getItem("visitorFlag"),openField:u()}),processor:d,fail:c})}}]).controller("demoFinStaCtrl",["$scope","$window","Api","FileSrv","NetSrv","DataSrv","$http","UI",function(e,t,i,a,n,s,o,l){e.dataList={file:[],base64:[]},e.activeIndex=0,e.imgSrc=e.dataList.base64[e.activeIndex];var r=function(t){e.failed=!1,e.result=s.json2table(t.mpRecognition.ocrInfoList.ocrInfo.ocrResult)},d=function(t){e.failed=!0,e.message=t.mpRecognition.resMsg,e.result=""};e.fileChanged=function(s){s.files.length&&/^image\/\w+$/g.test(s.files[0].type)&&(a.file2base64(s.files[0]).then(function(t){e.dataList.file.length<5?(e.dataList.file.push(s.files[0]),e.dataList.base64.push(t),e.activeIndex=e.dataList.file.length-1):(e.dataList.file[e.activeIndex]=s.files[0],e.dataList.base64[e.activeIndex]=t),e.imgSrc=t,e.$apply("imgSrc")}),n.ajaxFw({url:i.finSta,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:a.formData({myfile:s.files[0],visitorFlag:t.sessionStorage.getItem("visitorFlag")}),processor:r,fail:d}))},e.activeChanged=function(s){e.activeIndex=s,e.imgSrc=e.dataList.base64[e.activeIndex],n.ajaxFw({url:i.finSta,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:a.formData({myfile:e.dataList.file[s],visitorFlag:t.sessionStorage.getItem("visitorFlag")}),processor:r,fail:d})},e.modalOpen=function(){l.modalAlert({size:"lg",title:"识别结果",content:e.result,footer:!1})}}]).controller("demoBusLisCtrl",["$scope","$window","Api","Texts","FileSrv","NetSrv","DataSrv","$http","UI",function(e,t,i,a,n,s,o,l,r){e.dataList=[{file:[],base64:[]},{file:[],base64:[]},{file:[],base64:[]}],e.result=[],e.template=12002,e.tpls=[12002,12003,12004],e.tplIndex=e.tpls.indexOf(e.template),e.$watch("template",function(t,i){t!==i&&(e.tplIndex=e.tpls.indexOf(e.template))}),e.activeIndex=[0,0,0],e.imgSrc=[e.dataList[0].base64[e.activeIndex[0]],e.dataList[1].base64[e.activeIndex[1]],e.dataList[2].base64[e.activeIndex[2]]];var d=function(t){e.failed=!1;var i=o.dataFlat(t.mpRecognition.ocrInfoList.ocrInfo.ocrResult);e.result[e.tplIndex]=o.objTrans(i,transText)};e.message=[];var c=function(t){e.failed=!0,e.message[e.tplIndex]=t.mpRecognition.resMsg,e.result[e.tplIndex]=""};e.fields=a.getConfig(),e.saveConfig=function(){a.saveConfig(e.fields)};var u=function(){return a.openField(e.fields,e.template)};e.$watch("fields[template]",function(t,i){if(t!==i){var a=!0;for(var n in t)t[n].display&&t[n].checked&&(a=!1);e.saveDisabled=a}},!0),e.fileChanged=function(a){a.files.length&&/^image\/\w+$/g.test(a.files[0].type)&&(n.file2base64(a.files[0]).then(function(t){e.dataList[e.tplIndex].file.length<5?(e.dataList[e.tplIndex].file.push(a.files[0]),e.dataList[e.tplIndex].base64.push(t),e.activeIndex[e.tplIndex]=e.dataList[e.tplIndex].file.length-1):(e.dataList[e.tplIndex].file[e.activeIndex]=a.files[0],e.dataList[e.tplIndex].base64[e.activeIndex]=t),e.imgSrc[e.tplIndex]=t,e.$apply("imgSrc")}),s.ajaxFw({url:i.busLis,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n.formData({myfile:a.files[0],template:e.template,visitorFlag:t.sessionStorage.getItem("visitorFlag"),openField:u()}),processor:d,fail:c}))},e.activeChanged=function(a,o){e.activeIndex[a]=o,e.imgSrc[a]=e.dataList[a].base64[o],s.ajaxFw({url:i.busLis,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n.formData({myfile:e.dataList[a].file[o],template:e.template,visitorFlag:t.sessionStorage.getItem("visitorFlag"),openField:u()}),processor:d,fail:c})}}]).controller("demoFullTextCtrl",["$scope","NetSrv","Api","FileSrv","$window",function(e,t,i,a,n){e.dataList=[],e.activeIndex=0;var s=function(t){e.failed=!1,e.dataList[e.activeIndex].result=t},o=function(t){e.failed=!0,e.dataList[e.activeIndex].result=t};e.fileChanged=function(l){if(l.files.length&&/(image)|(pdf)/g.test(l.files[0].type)){var r={file:l.files[0],src:n.URL.createObjectURL(l.files[0])};e.dataList.length<5?(e.dataList.push(r),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=r,e.$apply("dataList"),t.ajaxFw({url:i.fullText,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:a.formData({myfile:l.files[0],visitorFlag:n.sessionStorage.getItem("visitorFlag")}),processor:s,fail:o})}},e.activeChanged=function(t){e.activeIndex=t}}]).controller("demoSilentLiveCtrl",["$scope","$window","NetSrv","Api",function(e,t,i,a){e.data={files:[],src:[],result:null,status:0};var n=function(i){e.data.files.length<3&&(e.data.files.push(i),e.data.src.push(t.URL.createObjectURL(i))),e.$apply("data"),console.log(e.data)};e.capture=function(e){n(e)},e.fileChanged=function(e){e.files.length&&/image\/\w+/g.test(e.files[0].type)&&n(e.files[0])},e.resultMap={1:"攻击样本",2:"活体"};var s=function(t){e.data.result=t,e.failed=!1,e.data.status=1},o=function(t){e.data.result=t,e.failed=!0,e.data.status=1};e.reco=function(){var n=new FormData;n.append("visitorFlag",t.sessionStorage.getItem("visitorFlag")),n.append("imgFiles",e.data.files[0]),n.append("imgFiles",e.data.files[1]),n.append("imgFiles",e.data.files[2]),i.ajaxFw({url:a.silentLive,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n,processor:s,fail:o})},e.reset=function(){e.data.files.length=0,e.data.src.length=0,e.data.result=null,e.data.status=0,e.failed=!1}}]).controller("demoBatchCtrl",["$scope","Api","UI","$http","FileSrv","DataSrv","$state","Texts",function(t,i,a,n,s,o,l,r){function d(s){var l={serviceType:m[c],template:t.template||"",responseType:0,sequence:o.uuid(),visitorFlag:window.sessionStorage.getItem("visitorFlag"),openField:f()},r=new FormData;for(var d in l)r.append(d,l[d]);for(var u=0;u<s.length;u++)r.append("imgFile",s[u]);return t.isLoading=!0,n({method:"POST",url:i.batch,transformRequest:e.identity,uploadEventHandlers:{progress:function(e){t.totalCount=s.length;for(var i=0,a=0,n=0;n<s.length&&(a+=s[n].size)<e.loaded;n++)i++;t.loadedCount=i}},data:r,headers:{"Content-Type":void 0}}).then(function(e){!function(){if("demo.idCard"===c)for(var t=e.data.mpRecognition.ocrInfoList,i=0;i<t.length;i++){console.log(t[i]);for(var a in t[i].ocrInfo.ocrResult)"isValid"===a&&(t[i].ocrInfo.ocrResult[a]=["是","否"][t[i].ocrInfo.ocrResult[a]])}}(),t.isAdd?Array.prototype.push.apply(t.dataList[t.activeIndex].result.ocrInfoList,e.data.mpRecognition.ocrInfoList):t.dataList[t.activeIndex].result=e.data.mpRecognition;t.dataList[t.activeIndex].result.ocrInfoList;t.isfinSta="demo.finSta"===c,console.log(t.dataList)},function(e){console.log(e),a.toast("请求失败，请检查网络连接。")}).then(function(){t.isLoading=!1})}t.dataList=[],t.activeIndex=0,t.activeSubIndex=0,t.isLoading=!1,t.isFullView=!1,t.isAdd=!1;t.fileChanged=function(e){if(e.files.length){var i=[];Array.prototype.push.apply(i,e.files),e.files.length>4&&(i=i.slice(0,4),a.toast("单次最多识别 4 张图片",5e3));var n=new function(e){this.files=e.files,this.src=e.src,this.subThumbs=function(){for(var t=[],i=0;i<e.files.length;i++)t.push(window.URL.createObjectURL(e.files[i]));return t}();var t;Object.defineProperty(this,"commonHead",{get:function(){var e=[];if(!this.result||!this.result.ocrInfoList||!this.result.ocrInfoList.length)return e;for(var i=this.result.ocrInfoList,a=0;a<i.length;a++){var n=i[a].ocrInfo.ocrResult||[];for(var s in n)-1===e.indexOf(s)&&e.push(s)}return-1!==e.indexOf("detail")&&(t=!0,e.splice([e.indexOf("detail")],1)),e}}),Object.defineProperty(this,"hasDetail",{get:function(){return this.commonHead,t}})}({files:i,src:window.URL.createObjectURL(i[0])});t.dataList.length>4?t.dataList[t.activeIndex]=n:(t.dataList.push(n),t.activeIndex=t.dataList.length-1),d(n.files),t.$apply("dataList")}},t.addItem=function(e){if(e.files.length){t.isAdd=!0;var i=4-t.dataList[t.activeIndex].files.length,n=[];Array.prototype.push.apply(n,e.files),e.files.length>i&&(n=n.slice(0,i),a.toast("此次最多可添加 "+i+" 张图片",5e3));var s={files:n,src:window.URL.createObjectURL(n[0]),subThumbs:function(){for(var e=[],t=0;t<n.length;t++)e.push(window.URL.createObjectURL(n[t]));return e}()};Array.prototype.push.apply(t.dataList[t.activeIndex].files,s.files),Array.prototype.push.apply(t.dataList[t.activeIndex].subThumbs,s.subThumbs),t.activeSubIndex=t.dataList[t.activeIndex].files.length-1,d(s.files).then(function(){t.isAdd=!1}),s=null,t.$apply("dataList")}},t.changeIndex=function(e){e!==t.activeIndex&&(t.activeIndex=e,t.activeSubIndex=0)},t.changeSubIndex=function(e){e!==t.activeSubIndex&&(t.activeSubIndex=e)},t.remove=function(e){if(t.dataList[t.activeIndex].files.splice(e,1),t.dataList[t.activeIndex].subThumbs.splice(e,1),t.dataList[t.activeIndex].result.ocrInfoList.splice(e,1),console.log(t.dataList),t.isFullView=!1,!t.dataList[t.activeIndex].files.length)return t.dataList.splice(t.activeIndex,1),void(t.activeIndex>=t.dataList.length&&(t.activeIndex=t.dataList.length-1));e||(t.dataList[t.activeIndex].src=window.URL.createObjectURL(t.dataList[t.activeIndex].files[0])),t.activeSubIndex>=t.dataList[t.activeIndex].files.length&&(t.activeSubIndex=t.dataList[t.activeIndex].files.length-1)},t.fullView=function(e){t.isFullView=!0},t.gridView=function(){t.isFullView=!1};var c=l.current.name;if(t.currSrv=c.split("demo.")[1],t.transText=r.trans,"demo.busLis"===c){t.template=12002;var u={12002:[],12003:[],12004:[]}}t.changeTemplate=function(e){t.isLoading||(t.gridView(),u[t.template]=t.dataList,t.dataList=u[e],t.template=e)};var m={"demo.face":"7","demo.idCard":"3","demo.creditCard":"2","demo.vat":"5","demo.finSta":"6","demo.busLis":"4"};t.fields=r.getConfig(),t.saveConfig=function(){r.saveConfig(t.fields)};var f=function(){return r.openField(t.fields,t.template)};t.fieldsView=t.template&&"demo.busLis"===c?t.fields[t.template]:t.fields,t.$watch("template",function(e,i){e!==i&&(t.fieldsView=t.template&&"demo.busLis"===c?t.fields[t.template]:t.fields)});var p=t.template&&"demo.busLis"===c?"fields[template]":"fields";t.$watch(p,function(e,i){if(e!==i){var a=!0;for(var n in e)e[n].display&&e[n].checked&&(a=!1);t.saveDisabled=a}},!0)}]).controller("docCtrl",["$window","$location","$rootScope","$anchorScroll",function(e,t,i,a){var n=e.sessionStorage.getItem("anchor");n&&a(n),e.sessionStorage.removeItem("anchor")}]).controller("priceCtrl",["$scope","$http","Api",function(e,t,i){e.current={storageApiTab:0,priceTab:0},e.storageTrans={23:"存储空间（GB）",3:"存储空间（月）"},t.get(i.price.feesPerTime).then(function(t){200===t.status&&t.data&&(e.perTime=t.data)}),t.get(i.price.feesPerMonth).then(function(t){200===t.status&&t.data&&(e.perMonth=t.data)}),t.get(i.price.feesPerYear).then(function(t){200===t.status&&t.data&&(e.perYear=t.data)}),t.get(i.price.imageStorage).then(function(t){200===t.status&&t.data&&(e.imageStorage=t.data)})}]).controller("contactCtrl",["$scope","$rootScope",function(e,t){e.current=0}])}(window.angular),function(e){e(window).on("scroll",function(){e(".tab-tits")[0]&&e(window).scrollTop()>e(".mps-navbar").height()?(e(".tab-tits").addClass("fixed"),e("body").css("marginTop",e(".mps-navbar").height()+"px")):(e(".tab-tits").removeClass("fixed"),e("body").css("marginTop",""))})}(window.jQuery),function(e){e.module("mpsDirectives",[]).directive("modalAlert",[function(){return{restrict:"EACM",template:'<div class="modal fade alert-modal-lg" id="modalAlert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog" ng-class="modal.alert.size"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title" id="myModalLabel" ng-bind="modal.alert.title">Modal title</h4></div><div class="modal-body" ng-bind-html="modal.alert.content"></div><div class="modal-footer" ng-if="modal.alert.footer"><button type="button" class="btn btn-primary" data-dismiss="modal">确定</button></div></div></div></div>',replace:!0,link:function(e,t,i){function a(){var e=t,i=e.find(".modal-dialog");e.css("display","block"),i.css("margin-top",Math.max(0,($(window).height()-i.height())/2)),e.css("display","")}e.$watch("modal",function(e,t){e!==t&&a()},!0),$(window).on("resize",function(){$(".modal:visible").each(a)})}}}]).directive("canvasSrc",["FileSrv",function(e){return{restrict:"A",link:function(t,i,a){a.$observe("canvasSrc",function(t,a){t&&t!==a&&e.canvasRender(i[0],t)})}}}]).directive("spinner",[function(){return{restrict:"EACM",template:'<div class="shade" ng-if="spinnerShow"><div class="loader"></div></div>',replace:!0,link:function(e){e.$watch("spinnerShow",function(e,t){e!==t&&(e?$("body").css({overflow:"hidden",paddingRight:15}):$("body").css({overflow:"",paddingRight:""}))})}}}]).directive("repeatFinish",[function(){return{restrict:"A",link:function(e,t,i){console.log(e.$index),1==e.$last&&e.$eval(i.repeatFinish)}}}]).directive("docMode",["$rootScope",function(e){return{restrict:"A",link:function(){}}}]).directive("myRadio",[function(){return{restrict:"E",template:function(e,t){return'<label><i class="fa" ng-class="{\'fa-circle-o\': !'+t.ngModel+", 'fa-dot-circle-o': "+t.ngModel+'}"></i><input type="radio" class="" ng-model="'+t.ngModel+'" name="'+t.name+'"><label>'},replace:!0,link:function(e,t,i){t.find("input[type=radio]").on("change",function(){e.$apply(),console.log(e)})}}}]).directive("cameraView",[function(){return{restrict:"E",template:'<div class="camera-view"><video></video><canvas class="hidden"></canvas><div class="flash-light"></div><div class="capture" ng-if="allowcapture" ng-click="flash()"><i class="fa fa-camera"></i><div></div>',replace:!0,scope:{allowcapture:"=allowcapture",oncapture:"=oncapture"},link:function(e,t,i){console.log(e);var a=t.find("canvas")[0],n=a.getContext("2d"),s=t.find("video")[0],o={video:{optional:[{minWidth:320},{minWidth:640},{minWidth:1024},{minWidth:1280},{minWidth:1920},{minWidth:2560}]}},l=function(e){console.log("Video capture error: ",e.code)};s.onloadeddata=function(){a.width=s.videoWidth,a.height=s.videoHeight},navigator.getUserMedia?navigator.getUserMedia(o,function(e){s.srcObject=e,s.play()},l):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(o,function(e){s.src=window.webkitURL.createObjectURL(e),s.play()},l):navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia(o,function(e){s.src=window.URL.createObjectURL(e),s.play()},l);var r=t.find(".flash-light");e.flash=function(){r.show(),n.drawImage(s,0,0,s.videoWidth,s.videoHeight),a.toBlob(function(t){var i=new File([t],Date.now()+".jpg",{type:"image/jpeg",size:t.size});e.oncapture&&e.oncapture(i)},"image/jpeg",.7)},r.on("animationend",function(){r.hide()})}}}])}(window.angular),function(e){e.module("mpsFilters",[]).filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}])}(window.angular),function(e){e.module("mpsSrvs",[]).service("Api",[function(){this.host="http://10.6.5.63:8099",this.loginStatus=this.host+"/mycenter/getLoginStatus",this.login=this.host+"/mycenter/sign_in",this.regist=this.host+"/mycenter/sign_up",this.logout=this.host+"/mycenter/logout",this.face=this.host+"/platform/faceone",this.idCard=this.host+"/platform/idcard",this.creditCard=this.host+"/platform/bankocr",this.vat=this.host+"/platform/invoiceocr",this.finSta=this.host+"/platform/finstatementocr",this.busLis=this.host+"/platform/filedocr",this.fullText=this.host+"/platform/fullTextocr",this.silentLive=this.host+"/platform/livenessVerify",this.batch=this.host+"/platform/batch/serviceForFile",this.price={imageStorage:this.host+"/order/getImageFeeList",feesPerTime:this.host+"/order/getFeesListAll?feesType=1",feesPerMonth:this.host+"/order/getFeesListAll?feesType=2",feesPerYear:this.host+"/order/getFeesListAll?feesType=3"}}]).service("Texts",["$state","$window",function(e,t){this.demoTexts={"demo.face":{desc:{tit:"人脸比对",con:"请上传本地图片，体验微模式人脸多特征属性的检测与识别功能。"},app:[{tit:"VIP 客户服务",img:"images/demo/yycj01.png",con:"对 VIP 客服进行自动人脸检测和比对，识别 VIP 客户信息并及时将信息推送到客户经理手持设备中，提升客户服务质量。"},{tit:"在线身份验证",img:"images/demo/yycj02.png",con:"对于客户现场照和身份证表面照片或联网核查照进行人脸识别和比对，实现在线身份验证，做好风险防范。"}]},"demo.idCard":{desc:{tit:"身份证识别",con:"请上传本地图片，体验微模式精准的身份证信息识别功能。"},app:[{tit:"二代证实名验证",img:"images/demo/yycj03.png",con:"识别身份证上的姓名和身份证号，发起联网核查，校验姓名和身份证号的一致性。"},{tit:"远程开户",img:"images/demo/yycj04.png",con:"识别一类账户银行卡表面信息，和银行业务系统对接进行校验，加快二类、三类账户的开通速度。"}]},"demo.creditCard":{desc:{tit:"银行卡识别",con:"请上传本地图片，体验快速准确的银行卡信息识别功能。"},app:[{tit:"银行卡绑定",img:"images/demo/yycj03.png",con:"快速准确地识别银行卡相关信息，用于手机银行卡绑定业务，无需手动输入银行卡号。"},{tit:"证卡实名验证",img:"images/demo/yycj04.png",con:"识别银行卡上的卡号以及二代证上的姓名和身份证信息，校验姓名、身份证号、银行卡号的一致性。"}]},"demo.vat":{desc:{tit:"增值税发票识别",con:"请上传本地图片，体验增值税发票识别，快速完成增值税专用发票的信息采集与结构化。"},app:[{tit:"税务认证",img:"images/demo/yycj05.png",con:"识别采集增值税发票信息，并形成电子档上传税务认证系统，进行税务认证。"},{tit:"票据归档",img:"images/demo/yycj06.png",con:"结构化数据导出，方便票据信息的归档。"}]},"demo.finSta":{desc:{tit:"财报识别",con:"请上传本地图片，体验财务报表识别，快速完成财务报表的信息采集与结构化。"},app:[{tit:"财务审计",img:"images/demo/yycj05.png",con:"识别财务报表信息，减少人工补录，提高财务审核效益。"},{tit:"财报归档",img:"images/demo/yycj06.png",con:"结构化数据导出，方便图表信息的归档。"}]},"demo.busLis":{desc:{tit:"营业执照识别",con:"请上传本地图片，体验营业执照识别，快速完成营业执照的信息采集与结构化。"},app:[{tit:"企业证照审核",img:"images/demo/yycj07.png",con:"识别企业证照信息，减少人工补录，提高对公开户等业务办理效率。"},{tit:"证照归档",img:"images/demo/yycj06.png",con:"证照归档—结构化数据导出，方便图像信息的归档。"}]},"demo.fullText":{desc:{tit:"全文字识别",con:"请上传本地图片，体验全文识别，快速完成资料结构化整理。"},app:[{tit:"法院文件识别",img:"images/demo/fullText01.png",con:"用于法院纸质文件识别，减少人工输入过程，提高输入效率。"},{tit:"资料结构化整理",img:"images/demo/fullText02.png",con:"用于笔记、书籍、档案等资料识别，方便您完成大量的资料结构化整理工作。"}]},"demo.silentLive":{desc:{tit:"静默活体检测",con:"请拍摄或上传三张图片，体验静默活体检测，识别静态图像上的生物目标是否为活体。"},app:[{tit:"法院文件识别",img:"images/demo/fullText01.png",con:"用于法院纸质文件识别，减少人工输入过程，提高输入效率。"},{tit:"资料结构化整理",img:"images/demo/fullText02.png",con:"用于笔记、书籍、档案等资料识别，方便您完成大量的资料结构化整理工作。"}]}},this.fields={vat:{NO:{name:"NO",value:"NO",checked:!0,display:!0},"开票日期":{name:"开票日期",value:"date",checked:!0,display:!0},"购买方纳税人识别号":{name:"购买方纳税人识别号",value:"buyerIdentificationNumber",checked:!0,display:!0},"密码区":{name:"密码区",value:"password",checked:!0,display:!0},"价税合计(大写)":{name:"价税合计(大写)",value:"totalPriceTaxUppercase",checked:!0,display:!0},"价税合计(小写)":{name:"价税合计(小写)",value:"totalPriceTaxLowercase",checked:!0,display:!0},"代码区域种类":{name:"代码区域种类",value:"codeAreaType",checked:!0,display:!0},"销售方纳税人识别号":{name:"销售方纳税人识别号",value:"sellerIdentificationNumber",checked:!0,display:!0},"合计金额":{name:"合计金额",value:"totalAmount",checked:!0,display:!0},"合计税额":{name:"合计税额",value:"totalTax",checked:!0,display:!0},"名称":{name:"名称",value:"名称",checked:!1,display:!1},"规格型号":{name:"规格型号",value:"规格型号",checked:!1,display:!1},"单位":{name:"单位",value:"单位",checked:!1,display:!1},"数量":{name:"数量",value:"数量",checked:!1,display:!1},"单价":{name:"单价",value:"单价",checked:!1,display:!1},"金额":{name:"金额",value:"金额",checked:!1,display:!1},"税率":{name:"税率",value:"税率",checked:!1,display:!1},"税额":{name:"税额",value:"税额",checked:!1,display:!1},"购买方名称":{name:"购买方名称",value:"purchaserName",checked:!0,display:!0},"销售方名称":{name:"销售方名称",value:"sellerName",checked:!0,display:!0},"明细":{name:"明细",value:"detailRegion",checked:!0,display:!0}},busLis:{12002:{"注册号":{name:"注册号",value:"registrationNumber",checked:!0,display:!0},"编号":{name:"证照编号",value:"serialNumber",checked:!0,display:!0},"组织机构代码证号":{name:"组织机构代码证号",value:"OrganizationCodeCertificate",checked:!0,display:!0},"税务登记号":{name:"税务登记号",value:"taxRegistryNumber",checked:!0,display:!0},"统一社会信用代码":{name:"统一社会信用代码",value:"socialCreditCode",checked:!0,display:!0},"名称":{name:"名称",value:"businessLicenseName",checked:!0,display:!0},"类型/主体类型":{name:"类型/主体类型",value:"businessLicenseType,mainType",checked:!0,display:!0},"住所/营业场所/主要经营场所":{name:"住所/营业场所/主要经营场所",value:"address,busnissPlace,mainBusnissPlace",checked:!0,display:!0},"法定代表人/投资人/负责人/执行事务合伙人":{name:"法定代表人/投资人/负责人/执行事务合伙人",value:"legalRepresentativeName,investor,personInCharge,managingPartner",checked:!0,display:!0},"注册资本":{name:"注册资本",value:"registeredCapital",checked:!0,display:!0},"成立日期":{name:"成立日期",value:"dateOfEstablishment",checked:!0,display:!0},"营业期限/合伙期限":{name:"营业期限/合伙期限",value:"busnissTerm,partnerTerm",checked:!0,display:!0}},12003:{"注册号":{name:"注册号",value:"registrationNumber",checked:!0,display:!0},"名称":{name:"名称",value:"businessLicenseName",checked:!0,display:!0},"法定代表人姓名":{name:"法定代表人姓名",value:"legalRepresentativeName",checked:!0,display:!0},"注册资本":{name:"注册资本",value:"registeredCapital",checked:!0,display:!0},"实收资本":{name:"实收资本",value:"paidUpCapital",checked:!0,display:!0}},12004:{"注册号":{name:"注册号",value:"registrationNumber",checked:!0,display:!0},"字号名称/名称":{name:"字号名称/名称",value:"typeName,businessLicenseName",checked:!0,display:!0},"经营者姓名":{name:"经营者姓名",value:"managerName",checked:!0,display:!0}}}},this.getConfig=function(i){var a=this,n=e.current.name.substr(e.current.name.indexOf(".")+1),s={vat:"vatFields",busLis:"busLisFields"};return JSON.parse(t.localStorage.getItem(s[n]))||a.fields[n]},this.saveConfig=function(i){var a=e.current.name.substr(e.current.name.indexOf(".")+1),n={vat:"vatFields",busLis:"busLisFields"};t.localStorage.setItem(n[a],JSON.stringify(i))},this.openField=function(e,t){var i=[];t&&(e=e[t]);for(var a in e)e[a].checked&&i.push(e[a].value);return i.join(",")},this.trans={idCard:{ucName:"姓名",ucSex:"性别",ucNat:"民族",ucBirth:"出生",ucAddress:"住址",ucNumber:"公民身份证号码",ucIssueUint:"签发机关",ucValidDate:"有效期限",isValid:"是否过期"},creditCard:{ucCardNum:"银行卡号",ucBankName:"银行卡名"},vat:{quantity:"数量",unitPrice:"单价",price:"金额",taxRate:"税率",taxAmount:"税额",goodsOrTaxableName:"货物或应税劳务名称",specificationsModels:"规格型号",unit:"单位",date:"开票日期",invoiceCode:"发票代码",invoiceNumber:"NO",totalPrice:"合计金额",taxTotalPrice:"合计税额",buyerIdentificationNumber:"购买方纳税人识别号",sellerIdentificationNumber:"销售方纳税人识别号",password:"密码区",totalPriceTaxLowercase:"价税合计（小写）",buyerName:"购买方名称",sellerName:"销售方名称",invoiceArea:"发票区域",invoiceType:"发票种类",totalPriceTaxUppercase:"价税合计（大写）",detail:"明细",name:"名称"},busLis:{code:"代码",validity:"有效期",registrationNumber:"注册号",businessLicenseName:"名称",legalRepresentative:"法定代表人",legalRepresentativeName:"法定代表人姓名",registeredCapital:"注册资本",dateOfEstablishment:"成立日期",businessLicenseType:"类型",busnissTerm:"营业期限",serialNumber:"编号",OrganizationCodeCertificate:"组织结构代码证",typeSize:"字号",typeSizeName:"字号名称",PermitNumber:"核准号",proprietorName:"经营者姓名",ScopeOfOperators:"经营者范围",domicile:"住所",address:"地址",companyType:"公司类型",paiclupCapital:"实收资本",templateType:"版面类型",socialCreditCode:"统一社会信用代码",personInCharge:"责任人",investor:"投资人",principal:"负责人",scope:"经营范围",taxNumber:"税务登记证号"}}}]).service("FileSrv",["$window",function(e){this.file2base64=function(e){var t=new FileReader;return new Promise(function(i,a){t.onload=function(){i(t.result)},e&&t.readAsDataURL(e)})},this.base642file=function(t){for(var i=e.atob(t.split(",")[1]),a=new ArrayBuffer(i.length),n=new Uint8Array(a),s=0;s<i.length;s++)n[s]=i.charCodeAt(s);var o=/^data\:(.+)\;base64$/.exec(t.split(",")[0])[1];return new File([a],Math.random().toString(36).substr(2)+"."+o.split("/")[1],{type:o})},this.imgCompress=function(t){t.file||console.log("文件不存在！");var i={file:t.file,maxPix:t.maxPix||192e4,maxByte:t.maxByte||1048576,cpsRatio:t.cpsRatio||.7},a={initSize:i.file.size,initWidth:0,initHeight:0,cpsSize:0,cpsWidth:0,cpsHeight:0,cpsRatio:""},n=document.createElement("canvas"),s=n.getContext("2d"),o=new Image,l=new FileReader;return new Promise(function(t,r){i.file.size>i.maxByte?(l.onload=function(){t(new File([l.result],i.file.name,{type:"image/jpeg"}))},new Promise(function(t,a){o.onload=t,o.src=e.URL.createObjectURL(i.file)}).then(function(){if(a.initWidth=o.width,a.initHeight=o.height,o.width*o.height>i.maxPix){var e=Math.sqrt(o.width*o.height/i.maxPix);n.width=a.cpsWidth=o.width/e,n.height=a.cpsHeight=o.height/e}else n.width=a.cpsWidth=o.width,n.height=a.cpsHeight=o.height;s.drawImage(o,0,0,n.width,n.height),n.toBlob(function(e){a.cpsSize=e.size,a.cpsRatio=a.cpsSize/a.initSize,console.log("初始文件大小："+a.initSize/1024+"kb\n初始宽度："+a.initWidth+"px\n初始高度："+a.initHeight+"px\n压缩后大小："+a.cpsSize/1024+"kb\n压缩后宽度："+a.cpsWidth+"px\n压缩后高度："+a.cpsHeight+"px\n压缩比："+parseInt(100*a.cpsRatio)+"%"),l.readAsArrayBuffer(e)},"image/jpeg",i.cpsRatio)})):(l.onload=t(i.file),console.log("图片未压缩！"),l.readAsDataURL(i.file))})},this.img2base64=function(e){var t=new Image,i=document.createElement("canvas"),a=i.getContext("2d");return new Promise(function(n,s){t.onload=function(){i.width=t.width,i.height=t.height,a.drawImage(e,0,0,i.width,i.height),n(i.toDataURL())},t.src=e.src})},this.src2img=function(e){var t=new Image;return new Promise(function(i,a){t.onload=i(t),t.src=e})},this.src2base64=function(e){var t=this;return this.src2img(e).then(t.img2base64)},this.src2file=function(e){var t=this;return this.src2base64(e).then(t.base642file)},this.formData=function(e){var t=new FormData;for(var i in e)t.append([i],e[i]);return t},this.canvasRender=function(e,t){console.dir(e),console.dir(t);var i=e.getContext("2d"),a=e.width,n=e.height,s=a/n,o=new Image;o.src=window.URL.createObjectURL(t),o.onload=function(){window.URL.revokeObjectURL(o.src);var e=o.width,t=o.height,l=o.width,r=o.height,d=e/t,c=0,u=0;a<e&&n<t&&(s>d?l=e*(r=n)/t:r=t*(l=a)/e),c=(a-l)/2,u=(n-r)/2,i.clearRect(0,0,a,n),i.drawImage(o,0,0,e,t,c,u,l,r)}}}]).service("NetSrv",["$rootScope","$http","$window","UI","Texts",function(e,t,i,a,n){this.obj2QStr=function(e){if("object"==typeof e){var t=[];for(var i in e){var a=[];a.push(encodeURIComponent(i)),a.push("="),a.push(encodeURIComponent(e[i])),t.push(a.join(""))}return t.join("&")}},this.ajaxFw=function(i){i.url&&i.data&&(i.cache||(e.spinnerShow=!0,t({method:"POST",url:i.url,headers:i.headers||{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:i.data}).then(function(t){if(t.data){var a=JSON.parse(t.data);a&&"00000"===a.mpRecognition.resCd?i.processor&&i.processor(a):a&&"00000"!==a.mpRecognition.resCd&&i.fail&&i.fail(a),e.spinnerShow=!1}},function(t){-1===t.status&&a.modalAlert({title:"错误",content:"数据请求失败，请检查网络连接。"}),e.spinnerShow=!1})))}}]).service("DataSrv",[function(){this.uuid=function(e){var t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[],n=i.length;if(e&&!isNaN(e))for(t=0;t<e;t++)a[t]=i[0|Math.random()*n];else{var s;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",t=0;t<36;t++)a[t]||(s=0|Math.random()*n,a[t]=i[19==t?3&s|8:s])}return a.join("")},this.dataFlat=function(e){for(var t={},i=0;i<e.length;i++)for(var a in e[i])t[a]=e[i][a];return t},this.obj2tabRec=function(e){var t=['<table class="table table-striped table-responsive table-hover"><tbody>'];for(var i in e)t.push("<tr>"),t.push("<td>"),t.push('"_$_一_f_"'),t.push(i),t.push('"_$_一_f_"'),t.push("</td>"),t.push("<td>"),t.push(e[i]),t.push("</td>"),t.push("</tr>");return t.push("</tbody></table>"),t.join("")},this.json2table=function(e){for(var t=e.table.tableRow,i=['<table class="table table-striped"><tbody>'],a=0;a<t.length;a++){i.push["<tr>"];for(var n=t[a].tableItem,s=0;s<n.length;s++){var o=n[s].value;i.push("<td>"),i.push(o),i.push("</td>")}i.push("</tr>")}return i.push("</tbody></table>"),i.join("")},this.flatobj2table=function(e){var t=['<table class="table table-striped"><tbody>'];for(var i in e)t.push("<tr>"),t.push("<td>"),t.push(i),t.push("</td>"),t.push("<td>"),t.push(e[i]),t.push("</td>"),t.push("</tr>");return t.push("</tbody></table>"),t.join("")},this.json2list=function(e){function t(e){if("string"==typeof e)i.push("<span>"),i.push(e),i.push("</span>");else if(e instanceof Array){i.push('<ul class="arr">');for(var a=0;a<e.length;a++)i.push("<li>"),t(e[a]),i.push("</li>");i.push("</ul>")}else if("object"==typeof e){i.push('<ul class="obj">');for(var n in e)i.push("<li>"),i.push('"_$_一_f_"'),i.push(n),i.push('"_$_一_f_"：'),t(e[n]),i.push("</li>");i.push("</ul>")}}var i=[];return t(e),i.join("")},this.textTrans=function(e,t){for(var i in t){var a='"\\_\\$\\_一\\_f\\_"'+i+'"\\_\\$\\_一\\_f\\_"',n=new RegExp(a,"g"),s=new RegExp('"\\_\\$\\_一\\_f\\_"',"g");e=e.replace(n,t[i])}return e=e.replace(s,"")},this.objTrans=function(e,t){var i=this;return i.textTrans(i.obj2tabRec(e),t)}}]).service("UI",["$rootScope","$timeout",function(e,t){this.modalAlert=function(i){e.modal||(e.modal={});var a={size:i.size?"modal-"+i.size:"",title:i.title?i.title:"提示信息",content:i.content?i.content:"",footer:!1!==i.footer};e.modal.alert=a,t(function(){$("#modalAlert").modal()},1e3,!1)},this.toast=function(e,t){var i=$('<div class="toast">'+(e||"")+"</div>").appendTo(document.body);window.setTimeout(function(){i.css("opacity",1)},0),window.setTimeout(function(){i.css("opacity",0),i.one("transitionend",function(){i.remove()})},t||3e3)}}])}(window.angular);